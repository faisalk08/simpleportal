<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>lib/wrapper/service.js - Simpleportal</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
	    <img alt="Simpleportal" src="../../favicon.ico" style="max-height: 65%;" title="Simpleportal">
            Simpleportal
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>1.0.0</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/__Base64", "classes/Base64", "classes/configuration", "classes/CRUDService", "classes/CsvParser", "classes/CsvReader", "classes/db", "classes/DBPool", "classes/Dispatchwrapper", "classes/Encryption", "classes/filterloader", "classes/LocalCache", "classes/Logger", "classes/logger", "classes/notificationcenter", "classes/oauth", "classes/pluginloader", "classes/PluginUtil", "classes/Resource installer", "classes/Response", "classes/Restfulmongo", "classes/router", "classes/Server", "classes/Service.CRUDService", "classes/Service.CUDService", "classes/Service.RemoteService", "classes/Service.RService", "classes/Service.StorageService", "classes/serviceloader", "classes/simpleportal", "classes/SimplePortalOAuth", "classes/startuploader", "classes/template", "classes/TemplateWrapper", "classes/util", "classes/viewloader", "modules/middleware", "modules/simpleportal", "modules/util", "modules/wrapper"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
	        <h3>APIs</h3>
	        <div id="sidebar">
	            <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
	                <li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>
	                <li><a href="#modules" data-toggle="tab">Modules</a></li>
	            </ul>
	    
	            <div id="api-tabview-filter">
	                <input type="search" placeholder="Type to filter APIs">
	            </div>
	    
	            <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
	                <div class="tab-pane active" id="classes">
	                    <ul id="api-classes" class="nav nav-list">
	                            <li><a href="../classes/Base64.html">Base64</a></li>
	                            <li><a href="../classes/configuration.html">configuration</a></li>
	                            <li><a href="../classes/CRUDService.html">CRUDService</a></li>
	                            <li><a href="../classes/CsvParser.html">CsvParser</a></li>
	                            <li><a href="../classes/CsvReader.html">CsvReader</a></li>
	                            <li><a href="../classes/db.html">db</a></li>
	                            <li><a href="../classes/DBPool.html">DBPool</a></li>
	                            <li><a href="../classes/Dispatchwrapper.html">Dispatchwrapper</a></li>
	                            <li><a href="../classes/Encryption.html">Encryption</a></li>
	                            <li><a href="../classes/filterloader.html">filterloader</a></li>
	                            <li><a href="../classes/LocalCache.html">LocalCache</a></li>
	                            <li><a href="../classes/Logger.html">Logger</a></li>
	                            <li><a href="../classes/logger.html">logger</a></li>
	                            <li><a href="../classes/notificationcenter.html">notificationcenter</a></li>
	                            <li><a href="../classes/oauth.html">oauth</a></li>
	                            <li><a href="../classes/pluginloader.html">pluginloader</a></li>
	                            <li><a href="../classes/PluginUtil.html">PluginUtil</a></li>
	                            <li><a href="../classes/Resource installer.html">Resource installer</a></li>
	                            <li><a href="../classes/Response.html">Response</a></li>
	                            <li><a href="../classes/Restfulmongo.html">Restfulmongo</a></li>
	                            <li><a href="../classes/router.html">router</a></li>
	                            <li><a href="../classes/Server.html">Server</a></li>
	                            <li><a href="../classes/Service.CRUDService.html">Service.CRUDService</a></li>
	                            <li><a href="../classes/Service.RemoteService.html">Service.RemoteService</a></li>
	                            <li><a href="../classes/Service.StorageService.html">Service.StorageService</a></li>
	                            <li><a href="../classes/serviceloader.html">serviceloader</a></li>
	                            <li><a href="../classes/simpleportal.html">simpleportal</a></li>
	                            <li><a href="../classes/SimplePortalOAuth.html">SimplePortalOAuth</a></li>
	                            <li><a href="../classes/startuploader.html">startuploader</a></li>
	                            <li><a href="../classes/template.html">template</a></li>
	                            <li><a href="../classes/TemplateWrapper.html">TemplateWrapper</a></li>
	                            <li><a href="../classes/util.html">util</a></li>
	                            <li><a href="../classes/viewloader.html">viewloader</a></li>
	                    </ul>
	                </div>
	    
	                <div class="tab-pane" id="modules">
	                    <ul id="api-modules" class="nav nav-list">
	                            <li><a href="../modules/middleware.html">middleware</a></li>
	                            <li><a href="../modules/simpleportal.html">simpleportal</a></li>
	                            <li><a href="../modules/util.html">util</a></li>
	                            <li><a href="../modules/wrapper.html">wrapper</a></li>
	                    </ul>
	                </div>
	            </div>
	        </div>
	    </div>
        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
                    Show:
                    <label for="api-show-inherited" class="checkbox">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected" class="checkbox">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private" class="checkbox">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated" class="checkbox">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </form>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <div class="page-header">
                            <h1>lib/wrapper/service.js <small>File</small></h1>
                        </div>
                        
                        <div class="file">
                            <pre class="prettyprint linenums">
                        /*!
                         * Simple Node Mobile Portal
                         * Copyright(c) 2012 Faisal Kottarathil
                         * MIT Licensed
                         */
                        var logger = require(&quot;./../logger&quot;);
                        var util = require(&quot;./../util&quot;);
                        var simpleportal = require(&#x27;./../simpleportal&#x27;);
                        
                        var defaultconfiguration = {
                        	modify : true,
                        	dbid:&#x27;default&#x27;,
                        	primaryKey:&#x27;id&#x27;,
                        	model:{},
                        	service:{}
                        };
                        
                        /**
                         * Simpleportal service 
                         * 
                         * @class Service.CRUDService
                         * @module simpleportal
                         * @submodule wrapper
                         * 
                         * @constructor
                         * @param {} options Options for the service 
                         *  
                         */
                        var Service = function(options) {
                        	var instance = this;
                        	
                            instance.modify = options.modify||false;
                            instance.remoteservice = options.remoteservice||false;
                            instance.defaultsort = options.defaultsort;
                            instance.hiddenFields = options.hiddenFields;
                            
                            instance.collection = options.collection;
                            instance.dbInstance = options.dbInstance;
                            
                            instance.dbid = options.dbid||&#x27;default&#x27;;
                            
                            instance.configuration = options.configuration||{};
                            instance.name = options.name;
                            
                            instance.primaryKey = options.primaryKey||&#x27;id&#x27;;
                            instance.primaryKeyType = options.primaryKeyType;
                            instance.primaryKeyFields = options.primaryKeyFields||[];
                            
                            instance.dataformat = options.dataformat;
                            instance.model = options.model||{};
                            instance.validation = options.validation;
                            instance.service = options.service||{};
                            instance.userrole = options.userrole;
                            
                            instance.auditfields = options.auditfields||[&#x27;_id&#x27;, &#x27;created_at&#x27;];
                            instance.csvfields = options.csvfields;
                            instance.searchqueryparams = options.searchqueryparams||{
                            	start:&#x27;&#x27;, end : &#x27;&#x27;, orderByCol : &#x27;&#x27;, orderByType:&#x27;&#x27;
                            };
                            instance.dbmodeloptions = {};
                        	if(options.configuration){
                            	instance.init(instance.configuration);
                            }
                        };
                        
                        /**
                         * Method which is executed during the Simpleportal server startup
                         *  
                         * @method onStartup
                         * 
                         * @param configuration Service configuration from configuration module Service configuration from configuration module
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.onStartup = function(configuration, callback){
                        	if(callback)
                        		callback();
                        }
                        
                        /**
                         * Method which is executed during the Simpleportal server shutdown
                         * 
                         * @method onShutdown
                         * 
                         * @param configuration Service configuration from configuration module
                         * @param {callback} callback The callback to excecute when complete
                         * @return 
                         */
                        Service.prototype.onShutdown = function(configuration, callback){
                        	if(callback)
                        		callback();
                        }
                        
                        /**
                         * Various data format functions to format the data send via http request
                         * 
                         * @property dataformat_
                         * @type Object
                         * 
                         * @private
                         */
                        Service.prototype.dataformat_ = {
                        	/*
                        	 * @method dataformat_.boolean
                        	 * 
                        	 * @param {} value
                        	 * @param {} defaultValue
                        	 * @param {} body
                        	 * @return boolvalue
                        	 * 
                        	 * @private
                        	 */
                        	boolean: function(value, defaultValue, body){
                        		var boolvalue = defaultValue||false;
                        		
                        		if(value == &#x27;true&#x27; || value)
                        			boolvalue = true;
                        		
                        		return boolvalue;
                        	},
                        	/*
                        	 * @method dataformat_.array
                        	 * 
                        	 * @param {} value
                        	 * @param {} defaultValue
                        	 * @param {} body
                        	 * 
                        	 * @return array of values
                        	 * 
                        	 * @private
                        	 */
                        	array: function(value, defaultValue, body){
                        		if(!value)
                        			return defaultValue||[];
                        		return util.getArrayValues(value);
                        	}
                        };
                        
                        /**
                         * Various data format functions to format the data send via http request
                         * 
                         * @property validation_
                         * @type Object
                         * 
                         * @private
                         */
                        Service.prototype.validation_ = {
                        	/**
                        	 * To validate whether the value is in a standard time format or not
                        	 * 
                        	 * Regular expression used is - /^(\d{1,2}(\.\d{2})?)([ap]m)?$/
                        	 * 
                        	 * @method validation_.time
                        	 * 
                        	 * @param {} value
                        	 * @return true if valid time else false
                        	 * @private
                        	 */
                        	time: function(value){
                        		return {isValid:value.match(/^(\d{1,2}(\.\d{2})?)([ap]m)?$/), message:&#x27;Not a valid Time!&#x27;};
                        	},
                        	
                        	/**
                        	 * To validate whether the value is a number
                        	 * 
                        	 * @method validation_.number
                        	 * 
                        	 * @param {} value
                        	 * @return true if valid number else false
                        	 * 
                        	 * @private
                        	 */
                        	number: function(value){
                        		return {isValid:true};
                        	},
                        	/**
                        	 * To validate whether the value is a url
                        	 * Regular expression used is - /(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!\-\/]))?/
                        	 * 
                        	 * @method validation_.url
                        	 * 
                        	 * @param {} value
                        	 * @return true if valid url else false
                        	 * 
                        	 * @private
                        	 */
                        	url:function(value){
                        		var regexp = /(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&amp;%@!\-\/]))?/
                        		return {isValid:regexp.test(value), message:&#x27;Not a valid URL&#x27;};
                        	}
                        };
                        
                        /**
                         * To get the object from the http request object based ont he model object, validation data format
                         * 
                         * @method getObject
                         * 
                         * @param {} request http request |Â object from where the object to be retreived
                         * 
                         * @return object Object which is Formatted and validated
                         */
                        Service.prototype.getObject = function(request){
                        	var instance = this;
                        
                        	var object = {};
                        	
                        	if(request &amp;&amp; request.body &amp;&amp; request.body[instance.name] &amp;&amp; typeof request.body[instance.name] === &#x27;object&#x27; ){
                        		object = request[instance.name];
                        	}else if(request &amp;&amp; request.body &amp;&amp; instance.model){
                        		var source = request.body;
                        		for(field in instance.model){
                        			if(source[field])
                        				object[field] = source[field];
                        			else
                        				object[field] = instance.model[field];
                        		}
                        	}
                        	
                        	if(instance.dataformat){
                        		for(format in instance.dataformat){
                        			if(format == &#x27;object&#x27;){
                        				
                        			}else if(object[format])
                        				object[format] = instance.dataformat[format](object[format], object[format], request);
                        		}
                        		if(instance.dataformat.hasOwnProperty(&#x27;object&#x27;)){
                        			object = instance.dataformat[&#x27;object&#x27;](object, request);
                        		}
                        	}
                        	
                        	if(instance.model){
                        		for(field in instance.model){
                        			if(typeof instance.model[field] == &#x27;boolean&#x27;)
                        				object[field] = instance.dataformat_.boolean(object[field], instance.model[field], request);
                        			else if(typeof instance.model[field] == &#x27;array&#x27;)
                        				object[field] =  instance.dataformat_.array(object[field], instance.model[field], request);
                        			else if (instance.model[field] instanceof Array)
                        				object[field] =  instance.dataformat_.array(object[field], instance.model[field], request);
                        			else if(typeof object[field] == &#x27;string&#x27;){
                        				object[field] = object[field].trim();
                        			}
                        		}
                        	}
                        	
                        	var validationmessages = [];
                        	if(instance.validation){
                        		for(validation in instance.validation){
                        			if(validation == &#x27;object&#x27;){
                        				
                        			//} else if(object[validation]){
                        			} else if(object.hasOwnProperty(validation)){
                        				var vdn = instance.validation[validation];
                        				if(typeof vdn == &#x27;string&#x27; &amp;&amp; instance.validation_[vdn]){
                        					var val_ = instance.validation_[vdn](object[validation])
                        					if(!val_.isValid){
                        						var message ={};
                        						message[validation] = val_.message||&#x27;Not valid!&#x27;;
                        						validationmessages.push(message);
                        					}	
                        				}else if(typeof vdn == &#x27;function&#x27;){
                        					var val_ = vdn(object[validation]);
                        					if(!val_.isValid){
                        						var message ={};
                        						message[validation] = val_.message||&#x27;Not Valid!&#x27;;
                        						validationmessages.push(message);
                        					}
                        				}
                        			}	
                        		}
                        		if(instance.validation.hasOwnProperty(&#x27;object&#x27;)){
                        			var vdn = instance.validation[validation];
                        			var val_ = vdn(object);
                        			if(!val_.isValid){
                        				var message ={};
                        				message[&#x27;Common Error -&#x27;] = val_.message;
                        				validationmessages.push(message);
                        			}
                        		}
                        	}
                        	
                        	object.validationmessages=validationmessages;
                        	return object;
                        }
                        
                        /**
                         * To get the object id for the object based on the primary key fields
                         * 
                         * @method getObjectId
                         * 
                         * @param {} object 
                         * 
                         * @return id for the object
                         */
                        Service.prototype.getObjectId = function(object){
                        	var instance = this;
                        
                        	var id = &#x27;&#x27;;
                        	if(instance.primaryKeyFields){
                        		for(i in instance.primaryKeyFields){
                        			var field = instance.primaryKeyFields[i];
                        			id += object[field];
                        		}
                        	}else
                        		id = object[instance.primaryKey];
                        	
                        	return simpleportal.db.generateId(id);
                        }
                        
                        /**
                         * To get the id of an object
                         * 
                         * @method getId
                         * 
                         * @param {} data
                         * @param {callback} callback The callback to excecute when complete 
                         */
                        Service.prototype.getId = function(data, callback){
                        	var instance = this;
                        	
                        	var id = simpleportal.db.generateId(data);
                        	
                        	var query = {};
                        	if(instance.primaryKeyType == &#x27;Number&#x27;)
                        		query[instance.primaryKey]=Number(id);
                        	else if (instance.primaryKeyType == &#x27;BSONUUID&#x27;)
                        		query[instance.primaryKey]=simpleportal.db.getObjectId(id);
                        	else
                        		query[instance.primaryKey]=id;
                        	
                        	instance.getStorageService().findOne(query, function(error, object) {
                        		if(error || !object || object == &#x27;&#x27;){
                        			/*instance.localCache.save({id:id, name:category}, function(error, sessionCategory) {
                        				if (!error &amp;&amp; sessionCategory) {
                        					callback(null, sessionCategory[0].id);
                        				}else
                        					callback(error);
                        			});*/
                        			callback(&#x27;No id found&#x27;);
                        		} else{
                        			callback(null, id);
                        		}
                        	});
                        }
                        
                        /**
                         * To get the Object ids 
                         * 
                         * @method getIds
                         * 
                         * @param {} data
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.getIds = function(data, callback){
                        	var instance = this;
                        
                        	if(!data)
                        		callback(null, []);
                        	else{
                        	 	var count = data.length;
                        		var checkedCount = 0;	
                        		var ids = [];
                        		for(index in data){
                        			if(categories[index] != &#x27;&#x27;)
                        				getId(data[index], function(error, id){
                        					if(!error){
                        						ids.push(id);
                        					}
                        					checkedCount++;
                        					if(checkedCount == count){
                        						callback(null, ids);
                        					}
                        				});
                        		}
                        	}
                        }
                        
                        /**
                         * To start the Service
                         * 
                         * @method start
                         * 
                         * @param {} appInstance 
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.start = function(appInstance, callback){
                        	var instance = this;
                        	logger.getInstance().info(&#x27;Simpleportal - Service : start&#x27;, instance.name);
                        	
                        	if(typeof configuration == &#x27;function&#x27;){
                        		callback=configuration;
                        		configuration={};
                        	}
                        	
                        	if(callback)
                        		callback();
                        }
                        
                        /**
                         * Fnction which is called during the Simpleportal server startup
                         * 
                         * @method startup
                         * 
                         * @param configuration Service configuration from configuration module
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.startup = function(configuration, callback){
                        	var instance = this;
                        	logger.getInstance().info(&#x27;Simpleportal - Service : startup&#x27;, instance.name);
                        	
                        	if(typeof configuration == &#x27;function&#x27;){
                        		callback=configuration;
                        		configuration={};
                        	}	
                        	
                        	if(instance.configuration &amp;&amp; instance.configuration.hasOwnProperty(&#x27;callservicestartup&#x27;)){
                        		if(instance.configuration.callservicestartup)
                        			this.onStartup(configuration, callback);
                        		else if(callback)
                        			callback();
                        	}else
                        		this.onStartup(configuration, callback);
                        }
                        
                        /**
                         * Function which will be executed during Simpleportal server shutdown
                         * 
                         * @method shutdown
                         * 
                         * @param configuration Service configuration from configuration module
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.shutdown = function(configuration, callback){
                        	var instance = this;
                        	if(typeof configuration == &#x27;function&#x27;){
                        		callback=configuration;
                        		configuration={};
                        	}	
                        	logger.getInstance().info(&#x27;Simpleportal - Service : shutdown&#x27;, instance.name);
                        	
                        	this.onShutdown(configuration, callback);
                        }
                        
                        /**
                         * To get the underlying storage service
                         * 
                         * @method getStorageService
                         * 
                         * @return The storage service 
                         */
                        Service.prototype.getStorageService = function(){
                        	var instance = this;
                        	
                        	if(!instance.storageService){
                        		return new StorageService({dbid:instance.dbid, collectionName:instance.collection});
                        	}else
                        		return instance.storageService;
                        }
                        
                        /**
                         * Initializing function of the service
                         * 
                         * @method init
                         * 
                         * @param configuration Service configuration from configuration module
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.init = function(configuration, callback){
                        	var instance = this;
                        	logger.getInstance().info(&#x27;Simpleportal - Service wrapper: init&#x27;, instance.name);
                        	
                        	instance.dbmodeloptions = {};
                        	
                        	if(instance.hiddenFields){
                        		for(field in instance.hiddenFields){
                        			instance.dbmodeloptions[instance.hiddenFields[field]]=0;
                        		}
                        	}
                        	if(instance.defaultsort){
                        		for(field in instance.defaultsort){
                        			instance.dbmodeloptions[field] = instance.defaultsort[field];
                        		}
                        	}
                        	
                        	if(configuration&amp;&amp;configuration.services)
                        		instance.configuration = configuration.services[instance.name];
                        	else if(configuration&amp;&amp;configuration[instance.name])
                        		instance.configuration = configuration[instance.name];
                        	
                            if(dbInstance)
                            	instance.dbInstance = dbInstance;
                            
                            if(instance.collection){
                            	var dbInstance = instance.dbInstance||simpleportal.db.getInstance();
                            	try{
                                    var db = simpleportal.db;
                                    instance.service = instance.service||{};
                        
                                	if(instance.dbid &amp;&amp; instance.collection) {
                                    	instance.storageService = new StorageService({dbid:instance.dbid, collectionName:instance.collection});
                                	
                                    	instance.rService = new RService(instance, {dbid:instance.dbid, collectionName:instance.collection});
                                	    
                                    	for(method in instance.rService){
                                    		if(instance.rService[method] == instance || method.indexOf(&#x27;before&#x27;) == 0)
                                    			continue;
                                    		if(!instance[method]){
                                    			var method_ = method;
                                    			var functioncall = function(method){
                                    				
                                    				instance[method] = function(arg1, arg2, arg3, arg4, arg5){
                                    					instance.rService[method](arg1, arg2, arg3, arg4, arg5)
                                        			};
                                    			}
                                    			functioncall(method);
                                    		}
                                	    }
                                	    
                                        if(!instance.service[&#x27;GET /&#x27;])
                                        	instance.get(&#x27;/&#x27;,function(request, response, callback) {
                                        		var options = instance.dbmodeloptions;
                                        		//{sorting:instance.defaultsort};
                                        		if(request.dbid)
                                        			options.dbid = request.dbid;
                                        		instance.rService.search({}, callback, options);
                                    	    });/* 
                                        	instance.service[&#x27;GET &#x27;] = function(request, response, callback) {
                                        		var options = instance.dbmodeloptions;
                                        		//{sorting:instance.defaultsort};
                                        		if(request.dbid)
                                        			options.dbid = request.dbid;
                                        		instance.rService.search({}, callback, options);
                                    	    };*/
                                        
                                	    if(!instance.service[&#x27;GET /count&#x27;])
                                	    	instance.get(&#x27;/count&#x27;, function(request, response, callback) {
                                	    		var options = instance.dbmodeloptions;
                                	    		//var options = {sorting:instance.defaultsort};
                                        		if(request.dbid)
                                        			options.dbid = request.dbid;
                                        		
                                        		instance.rService.count({}, function(error, count){
                                        			callback(error, {count:count||0});
                                        		}, options);
                                    	    });
                        
                                    	    
                                	    if(!instance.service[&#x27;GET /export-csv&#x27;])
                                	    	instance.get(&#x27;/export-csv&#x27;, function(request, response, callback) {
                                	    		var options = instance.dbmodeloptions;
                                	    		//var options = {sorting:instance.defaultsort};
                                        		if(request.dbid)
                                        			options.dbid = request.dbid;
                                        		
                                	    		instance.rService.search({}, function(error, data){
                        	        	    		instance.sendcsv(data, instance.csvfields, request, response);
                        	        	    	}, options);
                                    	    });
                                    	    
                                        if(!instance.service[&#x27;GET /:id&#x27;])
                                        	instance.get(&#x27;/:id&#x27;, function(request, response, callback) {
                        	                	var options = instance.dbmodeloptions;
                        	                	options.details = &#x27;true&#x27;;
                        	            		if(request.dbid)
                        	            			options.dbid = request.dbid;
                        	            		var o_id = request.pathGroup;
                        	        			/*if(request.query &amp;&amp; request.query.id &amp;&amp; (request.query.id.length == 12 || request.query.id.length == 24))
                        	        				o_id = {_id:simpleportal.db.getObjectId(request.query.id)};
                        	        		*/
                        	            		instance.rService.details(o_id, callback, options);
                                    	    });
                                    	    
                                        // registerR(instance);
                        
                                        if(instance.modify){
                                        	if(instance.dbid &amp;&amp; instance.collection){
                                        		instance.cudService = new CUDService(instance, {dbid:instance.dbid, collectionName:instance.collection});
                                        		
                                        		if(!instance.service[&#x27;POST /&#x27;])
                                        		instance.post(&#x27;/&#x27;, function(request, response, callback) {
                            	            		var options = {};
                            	            		if(request.dbid)
                            	            			options.dbid = request.dbid;
                            	            		
                            	            		instance.cudService.add(request, response, callback, options);
                            	                });
                            	                
                                        		if(!instance.service[&#x27;PUT /:id&#x27;])
                                        		instance.put(&#x27;/:id&#x27;, function(request, response, callback) {
                            	                	var options = instance.dbmodeloptions;
                            	            		if(request.dbid)
                            	            			options.dbid = request.dbid;
                            	            		
                            	                	instance.cudService.update(request, response, callback, options);
                            	                });
                            	                
                                        		if(!instance.service[&#x27;DELETE /:id&#x27;])
                            	                instance.remove(&#x27;/:id&#x27;, function(request, response, callback) {
                            	                	var options = {};
                            	            		if(request.dbid)
                            	            			options.dbid = request.dbid;
                        
                            	                	instance.cudService.remove(request, response, callback, options);
                            	                });
                            	                //instance.service[&#x27;DELETE /:id&#x27;] = ;
                                        	}
                                            
                                        	//registerCUD(instance);
                                        }
                                	}
                                    
                            	}catch(error){
                            		console.log(error);
                            	}
                            	if(instance.remoteservice){
                        			logger.getInstance().info(&#x27;Service Wrapper&#x27;, &#x27;Creating proxy services for Remote service - &#x27; + instance.name);
                        			instance.remoteService = new RemoteService(instance);
                            	}
                            	
                                if(callback)
                                	callback();
                        	} else if(instance.remoteservice){
                        		logger.getInstance().info(&#x27;Service Wrapper&#x27;, &#x27;Registering proxy services for Remote service - &#x27; + instance.name);
                        		instance.remoteService = new RemoteService(instance);
                        		
                        		if(!instance.service[&#x27;GET /&#x27;])
                                	instance.get(&#x27;/&#x27;,function(request, response, callback) {
                                		var options = instance.dbmodeloptions;
                                		if(request.dbid)
                                			options.dbid = request.dbid;
                                		
                                		var func_ = function(error, data){
                                			if(instance.aftersearch){
                                    			instance.aftersearch(error, data, callback);
                                    		}else
                                    			callback(error, data);
                                		}
                                		
                                		instance.remoteService.search({}, request, func_, options);
                            	    });
                                
                        	    if(!instance.service[&#x27;GET /count&#x27;])
                        	    	instance.get(&#x27;/count&#x27;, function(request, response, callback) {
                        	    		var options = instance.dbmodeloptions;
                        	    		if(request.dbid)
                                			options.dbid = request.dbid;
                                		
                        	    		instance.remoteService.search({}, request, callback, options);
                            	    });
                                
                        	    if(!instance.service[&#x27;GET /search&#x27;])
                        	    	instance.get(&#x27;/search&#x27;, function(request, response, callback) {
                        	        	var options = {};
                        	    		if(request.dbid)
                        	    			options.dbid = request.dbid;
                        					
                        					var func_ = function(error, data){
                                			if(instance.aftersearch){
                                    			instance.aftersearch(error, data, callback);
                                    		}else
                                    			callback(error, data);
                                		}
                                		
                        	    		instance.remoteService.search({}, request, func_, options);
                        	        });
                        		
                                if(!instance.service[&#x27;GET /:id&#x27;])
                                	instance.get(&#x27;/:id&#x27;, function(request, response, callback) {
                                    	var options = instance.dbmodeloptions;
                                    	options.details = &#x27;true&#x27;;
                                		if(request.dbid)
                                			options.dbid = request.dbid;
                                		var o_id = request.pathGroup;
                                		
                                		var func_ = function(error, data){
                                			if(instance.afterdetails){
                                    			instance.afterdetails(error, data, callback);
                                    		}else
                                    			callback(error, data);
                                		}
                                		
                                		instance.remoteService.details(o_id, request, func_, options);
                            	    });
                                if(!instance.service[&#x27;POST /&#x27;])
                        			instance.post(&#x27;/&#x27;, function(request, response, callback) {
                        				var object = instance.getObject(request);
                        				
                        				if(object.validationmessages &amp;&amp; object.validationmessages.length &gt; 0){
                        					callback(object.validationmessages, object);
                        				}else{
                        					delete object.validationmessages;
                        					
                        					instance.remoteService.add_update(null, object, request, callback);
                        				}
                        	        });
                                if(!instance.service[&#x27;PUT /&#x27;])
                                	instance.put(&#x27;/:id&#x27;, function(request, response, callback) {
                        				var object = instance.getObject(request);
                        				
                        				if(object.validationmessages &amp;&amp; object.validationmessages.length &gt; 0){
                        					callback(object.validationmessages, object);
                        				}else{
                        					delete object.validationmessages;
                        					
                        					instance.remoteService.add_update(request.pathGroup, object, request, callback);
                        				}
                        	        });
                                
                                if(!instance.service[&#x27;DELETE /&#x27;])
                        	        instance.remove(&#x27;/:id&#x27;, function(request, response, callback) {
                        	        	var options = {};
                        	    		if(request.dbid)
                        	    			options.dbid = request.dbid;
                        	
                        	    		instance.remoteService.remove(request.pathGroup, request, callback, options);
                        	        });
                                
                                if(callback)
                                	callback();
                        	} else{
                        		logger.getInstance().warn(&#x27;Sponsor Service&#x27;, &#x27;Service configuration is not done!!!&#x27;);
                            
                        	    if(callback)
                        	    	callback();
                        	}
                        };
                        
                        /**
                         * To send the data from the table|collection in a csv format
                         * 
                         * @method sendcsv
                         * 
                         * @param {} data 
                         * @param {} fields Fields that need to be included in the csv
                         * 
                         * @param {} request http request from the user
                         * @param {} response http response
                         */
                        Service.prototype.sendcsv = function(data, fields, request, response){
                        	this.sendcsv_(data, fields, request, response);
                        }
                        
                        /**
                         * To send the data from the table|collection in a csv format
                         * 
                         * @method sendcsv_
                         * 
                         * @param {} data 
                         * @param {} fields Fields that need to be included in the csv
                         * 
                         * @param {} request http request from the user
                         * @param {} response http response
                         * 
                         * @private
                         */
                        Service.prototype.sendcsv_ = function(data, fields, request, response){
                        	var result = new Array();
                        	
                        	var instance = this;
                        	var fields_ = [];
                        	if(!fields &amp;&amp; data){
                        		fields = fields||[];
                        		var _fields = data[0];
                        		for(var field in _fields){
                        			if(field == &#x27;_id&#x27;||field == &#x27;created_at&#x27;)
                        				continue;
                        			if(simpleportal.util.arraycontains(instance.auditfields, field))
                        				continue;
                        			
                        			fields.push(field);
                        			fields_.push(&#x27;&quot;&#x27; + field + &#x27;&quot;&#x27;)
                        		}
                        	}else
                        		for(var i in fields){
                        			var field = fields[i];
                        			if(field == &#x27;_id&#x27;||field == &#x27;created_at&#x27;)
                        				continue;
                        			if(simpleportal.util.arraycontains(instance.auditfields, field))
                        				continue;
                        			
                        			if(field.indexOf(&#x27;.&#x27;) != -1){
                        				fields_.push(&#x27;&quot;&#x27; + field.split(&#x27;.&#x27;)[0] + &#x27;&quot;&#x27;);
                        			}else 
                        				fields_.push(&#x27;&quot;&#x27; + field + &#x27;&quot;&#x27;)
                        		}
                        	
                        	result.push(fields_.join(&#x27;,&#x27;));
                        	
                        	data.forEach(function(obj){
                        		var obj_ = new Array();
                        		for(var i in fields){
                        			var field = fields[i];
                        			
                        			if(field.indexOf(&#x27;.&#x27;) != -1){
                        				var field_ = field.split(&#x27;.&#x27;)[1];
                        				var valueobj = obj[field.split(&#x27;.&#x27;)[0]];
                        				var values =[];
                        				if((valueobj instanceof Array || Array.isArray(valueobj)) &amp;&amp; typeof valueobj[0] == &#x27;string&#x27;){
                        					value = valueobj.join(&#x27;,&#x27;);
                        				}else if((valueobj instanceof Array || Array.isArray(valueobj)) &amp;&amp; typeof valueobj[0] == &#x27;object&#x27;){
                        					for(var itemi in valueobj){
                        						var item = valueobj[itemi];
                        						values.push(item[field_]);
                        					}
                        					value = values.join(&#x27;,&#x27;);
                        				} else if(typeof valueobj == &#x27;object&#x27;)
                        					value = valueobj[field_];
                        				else
                        					value = valueobj;
                        			}else{
                        				value = obj[field]||&#x27;&#x27;;
                        				
                        				if(value instanceof Array || Array.isArray(value) &amp;&amp; typeof value[0] != &#x27;object&#x27;){
                        					value = value.join(&#x27;,&#x27;);
                        				} else if(typeof value == &#x27;object&#x27;)
                        					value = JSON.stringify(value);
                        			}
                        			if(value)
                        				value = String(value);
                        			else
                        				value = &#x27;&#x27;;
                        			if(value.indexOf(&#x27;,&#x27;) != -1)
                        				value = &#x27;&quot;&#x27;+value + &#x27;&quot;&#x27;
                        			
                        			obj_.push(value);
                        		}
                        		
                        		result.push(obj_.join(&#x27;,&#x27;))
                        	});
                        	response.send(200, {&#x27;content-type&#x27;:&#x27;text/csv; charset=utf8&#x27;}, result.join(&#x27;\n&#x27;));
                        }
                        
                        /**
                         * Callback function when an api request is made to the service
                         * 
                         * @method call
                         * 
                         * @param {} path URI path requested
                         * @param {} request http request of the user
                         * @param {} response http response
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.call = function(path, request, response, callback){
                        	var instance = this;
                        
                        	var caller = instance.service[path];
                        	if(!caller)
                        		callback(&#x27;No such method!!&#x27;);
                        	
                        	if(typeof caller == &#x27;string&#x27;)
                        		caller = instance.service[caller];
                        	
                        	if(caller){
                        		caller(request, response, callback);
                        	}else
                        		callback(&#x27;Service Not found&#x27;);
                        }
                        
                        /**
                         * To register api for removing the records from the service
                         * 
                         * @method remove
                         * 
                         * @param {} path URI path 
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.remove = function(path, callback){
                        	var instance = this;
                        
                        	instance.register(path, callback, &#x27;DELETE&#x27;);
                        }
                        
                        /**
                         * To register api for getting records from the service
                         * 
                         * @method get
                         * @param {} path URI path
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.get = function(path, callback){
                        	var instance = this;
                        
                        	instance.register(path, callback, &#x27;GET&#x27;);
                        }
                        
                        /**
                         * To register api for putting records in to the service
                         * 
                         * @method put
                         * 
                         * @param {} path URI path
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.put = function(path, callback){
                        	var instance = this;
                        	instance.register(path, callback, &#x27;PUT&#x27;);
                        }
                        
                        /**
                         * To register api for posting records in to the service
                         * @method post
                         * 
                         * @param {} path URI path
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.post = function(path, callback){
                        	var instance = this;
                        	instance.register(path, callback, &#x27;POST&#x27;);
                        }
                        
                        /**
                         * To register sub api to the service
                         * 
                         * @method register
                         * 
                         * @param {string} path URI path
                         * @param {function} servicecallback calback function for the api
                         * @param {string} method http method
                         * 
                         * @private
                         */
                        Service.prototype.register = function(path, servicecallback, method){
                        	var instance = this;
                        	
                        	if(path &amp;&amp; path.indexOf(method) == -1)
                        		path = method+ &#x27; &#x27;+path;
                        	instance.service[path] =(function(servicecallback) {
                        	  return function(request, response, callback) {
                        		  instance.servicepre(request, response, servicecallback, callback);
                        	  }
                        	})(servicecallback);
                        }
                        
                        /**
                         * Method which is called before the service function is called
                         * 
                         * @method servicepre
                         * 
                         * @param {object} request http request
                         * @param {object} response http reponse
                         * @param {function} servicecallback service function
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.servicepre = function(request, response, servicecallback, callback){
                        	var instance = this;
                        	if(request.skipfilter)
                        		servicecallback(request, response, callback);
                        	else if(instance.userrole &amp;&amp; !request.isAuthenticated() &amp;&amp; !request.skipfilter){
                        		callback(&#x27;Permission denied&#x27;);
                        	}else if(instance.userrole &amp;&amp; (request.user&amp;&amp;instance.userrole != request.user.role) &amp;&amp; !request.skipfilter){
                        		callback(&#x27;Permission denied&#x27;);
                        	}else{
                        		if(instance.permissionCheck)
                        			instance.permissionCheck(request, null, request.user, function(error){
                        				if(error)
                        					callback(error);
                        				else
                        					servicecallback(request, response, callback);
                        			});
                        		else
                        			servicecallback(request, response, callback);
                        	}
                        }
                        
                        /**
                         * Method which is called after the service function is called
                         * 
                         * @method servicepost
                         * @param {} error error during the service pre function
                         * @param {} result data returend from the service pre function
                         * @param {} servicecallback service function
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         */
                        Service.prototype.servicepost = function(error, result, servicecallback, callback){
                        	var instance = this;
                        	servicecallback(error, result, callback);
                        }
                        
                        /**
                         * Read only service for connecting to database or a remote api 
                         * 
                         * @class Service.RService
                         * @constructor
                         * 
                         * @param {} superService Parent service 
                         * @param {} options Options for the service
                         * 
                         * @private
                         */
                        var RService = function(superService, options){
                        	var instance = this;
                        	  
                        	instance.service = superService;
                        };
                        
                        /**
                         * To search data from the backend service
                         * @method search
                         * 
                         * @param {} query JSON Query to search  
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options Configuration for the DB
                         */
                        RService.prototype.search = function(query, callback, options){
                        	var instance = this;
                        	options = options||{};
                        	
                        	if(instance.service[&#x27;beforeSearchCallback&#x27;]){
                        		instance.service.getStorageService().find(query, function(error, result){
                        			instance.service.beforeSearchCallback(error, result, callback);	
                        	    }, options);	
                        	}else
                        		instance.service.getStorageService().find(query, callback, options);
                        };
                        
                        
                        /**
                         * To get the count of records available in the backend service
                         * 
                         * @method count 
                         * @param {} query JSON Query to search  
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options Configuration for the DB or remote server
                         */
                        RService.prototype.count = function(query, callback, options){
                        	var instance = this;
                        	
                        	options = options||{};
                        	
                        	instance.service.getStorageService().count(query, callback, options);
                        };
                        
                        /**
                         * To get the details of a record
                         * 
                         * @method details
                         * @param {} id id of the record you want to get details  
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options Configuration for the database
                         */
                        RService.prototype.details = function(id, callback, options){
                        	var instance = this;
                        	options = options||{};
                        	
                        	var query = {};
                        	if(id &amp;&amp; typeof id == &#x27;object&#x27;)
                        		query = id; 
                        	else if(instance.service.primaryKeyType == &#x27;Number&#x27;)
                        		query[instance.service.primaryKey]=Number(id);
                        	else if (instance.primaryKeyType == &#x27;BSONUUID&#x27;)
                        		query[instance.primaryKey]=simpleportal.db.getObjectId(id);
                        	else
                        		query[instance.service.primaryKey]=id;
                        		
                        	if (id) {
                            	if(instance.service[&#x27;beforeDetailsCallback&#x27;])
                            		instance.service.getStorageService().findOne(query, function(error, result){
                            			if ((error || (!result|| result == &#x27;&#x27;)) &amp;&amp; query != id &amp;&amp; query[instance.service.primaryKey]&amp;&amp;(query[instance.service.primaryKey].length == 12||query[instance.service.primaryKey].length == 24)){
                            				try{
                            					instance.details({_id:simpleportal.db.getObjectId(query[instance.service.primaryKey])}, callback, options);
                            				}catch(error){
                            					callback(JSON.stringify(error));
                            				}
                            			}else if (!result || result == &#x27;&#x27;) 
                                            callback(&quot;There is no result found for the id &quot; + id);
                            			else
                            				instance.service.beforeDetailsCallback(error, result, callback);	
                            	    }, options);
                            	else{
                            		instance.service.getStorageService().findOne(query, function(error, result){
                            			if ((error || (!result || result == &#x27;&#x27;)) &amp;&amp; query != id &amp;&amp; query[instance.service.primaryKey] &amp;&amp;(query[instance.service.primaryKey].length == 12||query[instance.service.primaryKey].length == 24)){
                            				try{
                            					instance.details({_id:simpleportal.db.getObjectId(query[instance.service.primaryKey])}, callback, options);
                            				}catch(error){
                            					callback(JSON.stringify(error));
                            				}
                            			}else if (!result || result == &#x27;&#x27;) 
                                            callback(&quot;There is no result found for the id &quot; + id);
                            			else
                            				callback(error, result);	
                            	    }, options);
                            	}
                            } else {
                                callback(&quot;Please enter id for getting the details.&quot;);
                            }
                        };
                        
                        /**
                         * CUDService
                         * Service class for Create,Update,Delete 
                         * 
                         * @class Service.CUDService
                         * 
                         * @constructor
                         * 
                         * @param {} superService Parent service 
                         * @param {} options Options for the service
                         * 
                         * @private
                         */
                        var CUDService = function(superService, options){
                        	var instance = this;
                        	
                        	instance.service = superService;
                        };
                        
                        /**
                         * To add a record to the database table|collection
                         * 
                         * @method add
                         * 
                         * @param {} request http request
                         * @param {} response http response
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options Configuration for the database
                         */
                        CUDService.prototype.add = function(request, response, callback, options) {
                        	var instance = this;
                        	
                        	options = options||{};
                        	
                        	var object = instance.service.getObject(request);
                            var id = instance.service.getObjectId(object);
                            if(object.validationmessages &amp;&amp; object.validationmessages.length &gt; 0){
                            	callback(object.validationmessages, object);
                            } else if(id){
                                object.id = id;
                                var query = {};
                                if(request.query &amp;&amp; request.query.add_update)
                                	query = {id:id};
                                if(object.hasOwnProperty(&#x27;validationmessages&#x27;))
                                	delete object.validationmessages;
                                if(instance.service[&#x27;afterSave&#x27;])
                                	instance.service.getStorageService().add_update(query, object, function(error, result){
                                		if(error)
                                			callback(error, result);
                                		else
                                			instance.service.afterSave(error, result, callback, options);
                                	}, instance.service.beforeSave, options);
                                else
                                	instance.service.getStorageService().add_update(query, object, callback, instance.service.beforeSave, options);
                            }else{
                                callback({id:&#x27;Id is mandatory to proceed..&#x27;});
                            }
                        }
                        
                        /**
                         * To update a record in to the database
                         * 
                         * @method update
                         * 
                         * @param {} request http request
                         * @param {} response http response
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options Configuration for the database
                         */
                        CUDService.prototype.update = function(request, response, callback, options) {
                        	var instance = this;
                        	var id = request.pathGroup;
                            
                            var object = instance.service.getObject(request);
                            
                            options = options||{};
                        	
                            if(object.validationmessages &amp;&amp; object.validationmessages.length &gt; 0){
                            	callback(object.validationmessages, object);
                            } else if(id){
                                var new_id = instance.service.getObjectId(object);
                        
                                object.id = new_id;
                        
                                if(object.hasOwnProperty(&#x27;validationmessages&#x27;))
                                	delete object.validationmessages;
                                
                                if(instance.service[&#x27;afterSave&#x27;])
                                	instance.service.getStorageService().add_update({id:id}, object, function(error, result){
                                		if(error)
                                			callback(error, result);
                                		else
                                			instance.service.afterSave(error, result, callback, options);
                                	}, instance.service.beforeSave, options);
                                else
                                	instance.service.getStorageService().add_update({id:id}, object, callback, instance.service.beforeSave, options);
                            }else
                                callback(&#x27;Id is mandatory to proceed..&#x27;);
                        }
                        
                        /**
                         * To get the formatted object Ids from an array of nonformatted ids
                         * 
                         * @method getObjectIds
                         * 
                         * @param {Array} ids array of id strings
                         * @param {} instance Service instance
                         * 
                         * @return obj array of formatted ids
                         * @private
                         */
                        function getObjectIds(ids, instance){
                        	var obj;
                        	if(ids&amp;&amp;ids.indexOf(&#x27;,&#x27;) != -1){
                        		obj=[];
                        		var idsarray=ids.split(&#x27;,&#x27;);
                        		for(var i in idsarray){
                        			var objid=getObjectIds(idsarray[i], instance);
                        			if(objid)
                        				obj.push(objid);
                        		}
                        		
                        		return obj;
                        	}else if(ids&amp;&amp;ids.length &gt;0){
                        		if(ids &amp;&amp; typeof ids == &#x27;object&#x27;)
                        			return ids; 
                        		else if(instance.service.primaryKeyType == &#x27;Number&#x27;)
                        			return Number(ids);
                        		else if (instance.primaryKeyType == &#x27;BSONUUID&#x27;){
                        			return simpleportal.db.getObjectId(ids);
                        		}else{
                        			try{
                        				var o_id = simpleportal.db.getObjectId(ids);
                        				
                        				return o_id;
                        			}catch(error){
                        				return ids;
                        			}
                        		}
                        	}
                        	
                        	return obj;
                        }
                        
                        /**
                         * To remove a record from the database table|collection
                         * 
                         * @method remove
                         * 
                         * @param {} request http request
                         * @param {} response http response
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options Configuration for the database
                         */
                        CUDService.prototype.remove = function(request, response, callback, options) {
                        	var instance = this;
                        	var id = unescape(request.pathGroup);
                        	
                        	options = options||{};
                        	
                        	var query = {};
                        	
                        	var objid;
                        	if(id&amp;&amp;id.indexOf(&#x27;,&#x27;) != -1) 
                        		objid=getObjectIds(id, instance);
                        	
                        	if(id&amp;&amp;id.indexOf(&#x27;,&#x27;) != -1 &amp;&amp; objid &amp;&amp;  typeof objid==&#x27;object&#x27;){
                        		query={ &#x27;_id&#x27; : {$in : objid} };
                        	}else {
                        		if(id &amp;&amp; typeof id == &#x27;object&#x27;)
                        			query = id; 
                        		else if(instance.service.primaryKeyType == &#x27;Number&#x27;)
                        			query[instance.service.primaryKey]=Number(id);
                        		else if (instance.service.primaryKeyType == &#x27;BSONUUID&#x27;){
                        			query[instance.service.primaryKey]=simpleportal.db.getObjectId(id);
                        		}else
                        			query[instance.service.primaryKey]=id;
                        
                        		var searchquery = query;
                        		
                        		try{
                        			var o_id = simpleportal.db.getObjectId(id);
                        			query = {$or: [{ &#x27;_id&#x27; : o_id }, searchquery]};
                        		}catch(error){
                        			//console.log(error);
                        		}
                        	}
                        	
                            if (id) {
                            	if(instance.service[&#x27;beforeRemove&#x27;]){
                            		instance.service[&#x27;beforeRemove&#x27;](id, function(error){
                            			if(error)
                            				callback(error);
                            			else
                        	    			if(instance.service[&#x27;afterRemove&#x27;])
                        	                	instance.service.getStorageService().remove(query, function(error, result, callback){
                        	                		instance.service.afterRemove(error, result, callback, options);
                        	                	}, options);
                        	                else
                        	                	instance.service.getStorageService().remove(query, callback, options);
                            		}, request, response, options);
                            	}else{
                            		if(instance.service[&#x27;afterRemove&#x27;])
                                    	instance.service.getStorageService().remove(query, function(error, result, callback){
                                    		instance.service.afterRemove(error, result, callback, options);
                                    	}, options);
                                    else
                                    	instance.service.getStorageService().remove(query, callback, options);
                            	}
                            } else {
                                callback(&quot;Id is mandatory to proceed..&quot;);
                            }
                        }
                        
                        /**
                         * @class Service.StorageService
                         * 
                         * @constructor
                         * 
                         * @param {object} options Options for the service
                         */
                        var StorageService = function(options){
                        	var instance = this;
                        	
                        	instance.dbid = options.dbid||&#x27;default&#x27;;
                        	instance.collectionName = options.collectionName||&#x27;default&#x27;;
                        }
                        
                        /**
                         * To get the underlying db instance
                         * 
                         * @method getDBInstance
                         * 
                         * @param {} options Options for the db instance
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         */
                        StorageService.prototype.getDBInstance = function(options, callback){
                        	var instance = this;
                        	
                        	var db = simpleportal.db;
                        	if(typeof options == &#x27;function&#x27; ){
                        		callback = options;
                        		options = {};
                        	}
                        	options = options||{};
                        	
                        	db.dbpool.getInstance((options.dbid||instance.dbid), callback);
                        };
                        		
                        /**
                         * To get the underlying database table|collection
                         * 
                         * @method getCollection
                         * 
                         * @param {} options Options for the db instance
                         * @param {callback} callback The callback to excecute when complete
                         */
                        StorageService.prototype.getCollection = function(options, callback){
                        	var instance = this;
                        	
                        	if(typeof options ==&#x27;fiunction&#x27;){
                        		callback=options;
                        		options = {};
                        	}
                        	
                        	options = options||{};
                        	var db = simpleportal.db;
                        	
                        	db.dbpool.getInstance((options.dbid||instance.dbid), function(error, dbInstance){
                        		if(error){
                        			callback(error);
                        		}else{
                        			dbInstance.collection(instance.collectionName, function(error, collection) {
                                        if( error ){
                                        	callback(error);
                                        } else {
                            				callback(null, collection);
                                        }
                                    });
                        		}
                        	});
                        }
                        
                        /**
                         * To re save an exisiting object in the database table|collection
                         * 
                         * @method resaveobject
                         * 
                         * @param {} object Object that need to be resaved
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         * 
                         * @param {} service Service instance
                         * @param {} options dataabse configuration
                         */
                        StorageService.prototype.resaveobject = function(object, callback, service, options){
                        	var instance = this;
                        	delete object._id;
                        	
                        	if(service[&#x27;afterSave&#x27;])
                        		instance.add_update({id:object.id}, object, function(error, newobj){
                        			if(error)
                            			callback(error, newobj);
                            		else
                            			service.afterSave(error, newobj, callback, options);
                        		}, service.beforeSave, options);
                            else
                        		instance.add_update({id:object.id}, object, function(error, newobj){
                        			callback(error, newobj);
                        		}, service.beforeSave, options);
                        }
                        
                        /**
                         * To check the data for integrity check
                         * 
                         * @method checkcollection
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} service Service instance
                         * @param {} options datatabse configuration
                         */
                        StorageService.prototype.checkcollection = function(callback, service, options){
                        	var instance = this;
                        	options = options||{};
                        	logger.getInstance().info(&#x27;Simpleportal -servicewrapper&#x27;, &#x27;re saving the data, incase of any audit field is missing! - &#x27; + service.name);
                        	instance.findAll(function(error, result){
                        		if(result &amp;&amp; !error){
                        			var count = result.length;
                        			var callbackcount = 0;
                        			result.forEach(function(object){
                        				instance.resaveobject(object, function(error, newobj){
                        					if(count == ++callbackcount)
                        						callback(null);
                        				}, service, options);
                        			});
                        		}else
                        			callback(error);
                        	}, options);
                        };
                        
                        /**
                         * To save the record in to the underlying databse table|collection
                         * 
                         * @method save
                         * 
                         * @param {} results objest as array or single object 
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.save = function(results, callback, options){
                        	var instance = this;
                        	options = options||{};
                        	if(!results){
                        		logger.getInstance().warn(&#x27;Simple Portal - storage service&#x27;, &#x27;No result skipping save!!&#x27;);
                        		callback(&#x27;No result skipping save!!&#x27;);
                        	}else {
                        		var single = true;
                        		if(results &amp;&amp; typeof(results.length) == &quot;undefined&quot;){
                        			results.created_at = new Date();
                        
                        			instance.getCollection(options, function(error, collection){
                        				if(error)
                        					callback(error);
                        				else
                        					collection.insert(results, function(error, data){
                        						if(data &amp;&amp; typeof(data.length) == &quot;undefined&quot;){
                        							callback(error, data);
                        						} else if(data)
                        							callback(error, data[0]);
                        						else 
                        							callback(error, data);
                        					});
                        			});
                        		}else{
                        			for( var i = 0; i&lt; results.length; i++ ) {
                        				result = results[i];
                        				result.created_at = new Date();
                        			}	
                        
                        			instance.getCollection(options, function(error, collection){
                        				if(error)
                        					callback(error);
                        				else
                        					collection.insert(results, function(error, data){
                        						callback(error, data);
                        					});
                        			});
                        		}
                        	}
                        };
                        
                        /**
                         * To find records from the databse table|collection
                         * 
                         * @method find
                         * 
                         * @param {} query JSON search query
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.find = function(query, callback, options) {
                        	var instance = this;
                        	options = options||{};
                        	var dboptions = util.extendJSON({}, options);//options||{};
                        	
                        	if(dboptions &amp;&amp; dboptions.hasOwnProperty(&#x27;details&#x27;))
                        		delete dboptions.details;
                        	if(dboptions &amp;&amp; dboptions.hasOwnProperty(&#x27;dbid&#x27;))
                        		delete dboptions.dbid;
                        	
                        	instance.getCollection(options, function(error, collection){
                        		console.log();
                        		
                        		if(error)
                        			callback(error);
                        		else{
                        			collection.find(query, dboptions).toArray(function(error, results) {
                        				callback(error, results);
                        		    });
                        		}
                        	});
                        };
                        
                        /**
                         * To find all records from the database table|collection
                         * 
                         * @method findAll
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.findAll = function(callback, options) {
                        	var instance = this;
                        	
                        	options = options||{};
                        	//var dboptions = options;
                        	var dboptions = util.extendJSON({}, options);//options||{};
                        
                        	if(dboptions &amp;&amp; dboptions.hasOwnProperty(&#x27;details&#x27;))
                        		delete dboptions.details;
                        	if(dboptions.hasOwnProperty(&#x27;dbid&#x27;))
                        		delete dboptions.dbid;
                        	
                        	instance.getCollection(options, function(error, collection){
                        		if(error)
                        			callback(error);
                        		else{
                        			collection.find({}, dboptions).toArray(function(error, results) {
                        				callback(error, results);
                        		    });
                        		}
                        	});
                        };
                        
                        /**
                         * To find a record from the databse table|collection
                         * 
                         * @method findOne
                         * @param {} query JSON search query
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.findOne = function(query, callback, options) {
                        	var instance = this;
                        	query = query || {};
                        	//var dboptions = options||{};
                        	options = options||{};
                        	var dboptions = util.extendJSON({}, options)
                        	
                        	if(dboptions &amp;&amp; dboptions.hasOwnProperty(&#x27;details&#x27;))
                        		delete dboptions.details;
                        	if(dboptions.hasOwnProperty(&#x27;dbid&#x27;))
                        		delete dboptions.dbid;
                        	
                        	instance.getCollection(options, function(error, collection){
                        		if(error)
                        			callback(error);
                        		else{
                        			collection.findOne(query, dboptions, callback);
                        		}	
                        	});
                        };
                        
                        /**
                         * To remove a record from the database table|Ã§ollection
                         * 
                         * @method remove
                         * 
                         * @param {} query JSON search query
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.remove = function(query, callback, options) {
                        	var instance = this;
                        
                        	//var dboptions = options||{};
                        	options = options||{};
                        	var dboptions = util.extendJSON({}, options);
                        	
                        	instance.getCollection(dboptions, function(error, collection){
                        		if(error)
                        			callback(error);
                        		else{
                        			collection.remove(query, function(error, removedCount){
                        				
                        				if(removedCount==0&amp;&amp;!error)
                        					error=&#x27;No record deleted!&#x27;;
                        				
                        				if(callback)
                        					callback(error, removedCount);
                        			});
                        			//callback(null, {});
                        		}
                        	});
                        };
                        
                        /**
                         * To update a record in to the databse table|collection
                         * @method update
                         * 
                         * @param {} query JSON search query
                         * @param {} data data to be updated
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.update = function(query, data, callback, options) {
                        	var instance = this;
                        	options = options||{};
                        	var dboptions = util.extendJSON({}, options);
                        	
                        	instance.getCollection(dboptions, function(error, collection){
                        		if(error)
                        			callback(error);
                        		else{
                        			data.modified_at = new Date();
                        			collection.update(query, {$set: data}, {safe:true}, function(error, updateCount, updatedetails){
                        				if(updateCount == 0)
                        					callback({updateCount:updateCount, messaeg : &#x27;No record updated&#x27;}, updatedetails);
                        				else if(error)
                        					callback(error, updatedetails);
                        				else
                        					collection.findOne(query, callback);
                        			})
                        		}
                        	});
                        };
                        
                        /**
                         * To ge the number of records in the database table|collection
                         * 
                         * @method count
                         * @param {} query JSON search query
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.count = function(query, callback, options) {
                        	var instance = this;
                        	options = options||{};
                        	var dboptions = util.extendJSON({}, options);
                        	
                        	instance.getCollection(dboptions, function(error, collection){
                        		if(error)
                        			callback(error);
                        		else
                        			collection.count(query, function(error, count) {
                        				callback(error, count);
                        			});
                        	});
                        };
                        
                        /**
                         * To clear all records in a database table|collection
                         * 
                         * @method clear
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.clear = function(callback, options) {
                        	var instance = this;
                        
                        	options = options||{};
                        	var dboptions = util.extendJSON({}, options);
                        	
                        	instance.getCollection(dboptions, function(error, collection){
                        		if(error)
                        			callback(error);
                        		else{
                        			collection.remove();
                        			callback(null, {});
                        		}
                        	});
                        };
                        
                        /**
                         * To make a particular field in the table|collection to be induxed for faster read
                         * 
                         * @method ensureIndex
                         * 
                         * @param {} query
                         * @param {} arg1
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.ensureIndex = function(query, arg1, callback, options) {
                        	var instance = this;
                        	options = options||{};
                        	var dboptions = util.extendJSON({}, options);
                        	
                        	if(query){
                        		var dboptions = options||{};
                        		instance.getCollection(dboptions, function(error, collection){
                        			if(error)
                        				callback(error);
                        			else{
                        				if(arg1)
                        					collection.ensureIndex(query, arg1);
                        				else
                        					collection.ensureIndex(query);
                        				if(callback)
                        					callback(null, {});
                        			}
                        		});
                        	} else if(callback)
                        		callback(&#x27;No query mentioned!!&#x27;);
                        };
                        
                        /**
                         * To add or update record, if the record is available then it will update the record, else it will add a new record
                         * @method add_update
                         * 
                         * @param {} query JSON Query to check for existing record, mostly the primary key|unique fields in the database
                         *  
                         * @param {object} object Object to be saved in to the database
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         * @param {function} beforeSave Function which will be executed before saving the record
                         * @param {} options databse configuration
                         */
                        StorageService.prototype.add_update = function(query, object, callback, beforeSave, options){
                        	var instance = this;
                        	
                        	if(beforeSave){
                        		beforeSave(object, function(error, object){
                        			if(error)
                        				callback(error);
                        			else
                        				instance.add_update(query, object, callback, null, options);
                        		}, options);
                        	} else{
                        		if(query &amp;&amp; query.id){
                        			if (query.id) {
                        				if(query.id != object.id){
                        					var dbquery={};
                        					if(query.id.length == 24){
                        						dbquery={$or:[{id:object.id}, {_id:simpleportal.db.getObjectId(query.id)}]}
                        					}else
                        						dbquery={id: query.id};
                        					
                        					instance.findOne({id: object.id}, function(err, objectFromDB) {
                        						if ((!objectFromDB || objectFromDB == &#x27;&#x27;)||(objectFromDB&amp;&amp;objectFromDB._id==query.id)) {
                        							instance.update(dbquery, object, callback, options);
                        						} else {
                        							callback({id:&quot;A  record with id -&quot; + object.id + &quot; is already exists in our database. Please enter new values.&quot;});
                        						}
                        					}, options);
                        				}else{
                        					var dbquery={};
                        					if(query.id.length == 24){
                        						dbquery={$or:[{id:object.id}, {_id:simpleportal.db.getObjectId(query.id)}]}
                        					}else
                        						dbquery={id: query.id};
                        						
                        					instance.findOne(dbquery, function(err, objectFromDB) {
                        						if((!objectFromDB || objectFromDB == &#x27;&#x27;)){
                        							instance.save(object, callback, options);
                        						} else if((objectFromDB.id == object.id)||(objectFromDB&amp;&amp;objectFromDB._id==object.id)) {
                        							instance.update(dbquery, object, callback, options);
                        						} else {
                        							callback({id:&quot;A  record with id -&quot; + object.id + &quot; is already exists in our database. Please enter new values.&quot;});
                        						}
                        					}, options);
                        				}/*
                        					instance.update({id: query.id}, object, callback, options);*/
                        			} else {
                        				callback({id:&quot;Please enter the id-&quot; + query.id + &quot; for updating&quot;});
                        			}
                        		} else{
                        			var id = object.id;
                        			if(id){
                        				if(id.length == 24){
                        					dbquery={$or:[{id:id}, {_id:simpleportal.db.getObjectId(id)}]}
                        				}else
                        					dbquery={id: id};
                        				
                        				instance.findOne(dbquery, function(err, objectFromDB) {
                        					if ((!objectFromDB || objectFromDB == &#x27;&#x27;)||(objectFromDB&amp;&amp;objectFromDB._id==object.id)) {
                        						instance.save(object, function(error, data){
                        							if(!error&amp;&amp;!data){
                        								instance.findOne(dbquery, callback);
                        							}else
                        								callback(error, data);
                        						}, options);
                        					} else {
                        						callback({id:&quot;A  record with id -&quot; + object.id + &quot; is already exists in our database. Please enter new values.&quot;});
                        					}
                        				}, options);
                        			} else{
                        				callback({id:&quot;The id is missing. Please enter new values.&quot;});
                        			}
                        		}
                        	}
                        }
                        
                        /**
                         * To get the distinct values from the database table|collection
                         * 
                         * @method distinct
                         * 
                         * @param {} field field for which the distinct values are searched
                         * @param {} query JSON search query
                         * @param {callback} callback The callback to excecute when complete
                         */
                        StorageService.prototype.distinct = function(field, query, callback) {
                        	var instance = this;
                        	
                        	instance.getCollection({}, function(error, collection){
                        		if(error)
                        			callback(error);
                        		else{
                        			var ary = collection.distinct(field);
                        		}
                        	});
                        };
                        
                        /**
                         * RemoteService
                         * 
                         * Servcie wrapper for connecting to remote Service
                         * 
                         * @class Service.RemoteService
                         * @constructor
                         * 
                         * @param {} service Parent service
                         */
                        var RemoteService = function(service){
                        	var instance = this;
                        	
                        	instance.service = service;
                        	instance.serveroptions = instance.service.configuration||{};
                        }
                        
                        /**
                         * To add or update record, if the record is available then it will update the record, else it will add a new record
                         * 
                         * @method add_update
                         * @param {} id id ofthe record
                         * @param {object} object Object to be saved in to the database
                         * @param {} request http request
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} cache whether to cache the data in to the local database or not
                         */
                        RemoteService.prototype.add_update = function(id, object, request, callback, cache){
                        	var instance = this;
                        	
                        	logger.getInstance().info(&#x27;Simpleportal -service wrapper&#x27;, instance.serveroptions);
                        	logger.getInstance().info(&#x27;Simpleportal -service wrapper&#x27;, instance.service.configuration);
                        	
                        	var path = instance.service.configuration.search.path;
                        	if(instance.service.configuration.details &amp;&amp; instance.service.configuration.search.details)
                        		path = instance.service.configuration.details.path + &#x27;/&#x27; + id;
                        	
                        	if(id){
                                path = path + &#x27;/&#x27; + id;
                                
                                if(id.indexOf(&#x27;/&#x27;) == -1 &amp;&amp; instance.serveroptions.details &amp;&amp; instance.serveroptions.details.sub_path)
                                    path = path + &#x27;/&#x27; + instance.serveroptions.details.sub_path;
                            }else if(instance.serveroptions.details &amp;&amp; instance.serveroptions.details.sub_path)
                                path = path + &#x27;/&#x27; + instance.serveroptions.details.sub_path;
                        	
                        	var server_options = {
                              host: instance.service.configuration.host,
                              port: instance.service.configuration.port,
                              path: path,
                              method:(id ? &#x27;PUT&#x27; : &#x27;POST&#x27;),
                              oauth:instance.service.configuration.oauth,
                              secure:instance.service.configuration.secure||false
                            };
                        	
                        	server_options.postdata = JSON.stringify(object);
                        	
                        	util.post(server_options, request, function(err, results){
                        		if(err){
                        			logger.getInstance().warn(&#x27;Simpleportal -service wrapper&#x27;, &#x27;Some Error while add/update to remote server!!&#x27; + err);
                        			callback(err);
                        		}else{
                        			callback(err, results);
                        		}
                        	});
                        }
                        
                        /**
                         * To form the search parameters from the search object for search api
                         * 
                         * @method searchqueryparams_
                         * 
                         * @param {} query exisiting search query
                         * @param {} request http request
                         * @return queryparams
                         * 
                         * @private
                         */
                        RemoteService.prototype.searchqueryparams_ = function(query, request){
                        	var instance = this;
                        	
                        	var params = instance.serveroptions.search.queryparams||instance.service.searchqueryparams;
                        	
                        	var queryfields = [];
                        	if(params){
                        		for(var param in params){
                        			var fields = params[param];
                        			if(!fields || fields == &#x27;&#x27;){
                        				queryfields.push({field:param, remotefield:param});
                        			}else{
                        				queryfields.push({field:param, remotefield:fields});
                        			}
                        		}
                        	}
                        	
                        	var queryparams =[];
                        	if(queryfields &amp;&amp; request.query)
                        		for(var querfield in queryfields){
                        			var field = queryfields[querfield];
                        			
                        			if(request.query[field.field] &amp;&amp; request.query[field.field] != &#x27;&#x27;){
                        				queryparams.push(field.remotefield + &#x27;=&#x27; + escape(request.query[field.field]));
                        			}
                        		}
                        	if(query){
                        		for(var q in query)
                        			queryparams.push(q + &#x27;=&#x27; + query[q]);
                        		
                        	}
                        	return queryparams;
                        }
                        
                        /**
                         * To get the search parameters as JSON object
                         * 
                         * @method searchqueryparamsAsJSON
                         * 
                         * @param {} query search query object
                         * @param {} request http request
                         * 
                         * @return queryparams JSON object with search parameters
                         * @private
                         */
                        RemoteService.prototype.searchqueryparamsAsJSON = function(query, request){
                        	var instance = this;
                        	
                        	var params = instance.serveroptions.search.queryparams||instance.service.searchqueryparams;
                        	
                        	var queryfields = [];
                        	if(params){
                        		for(var param in params){
                        			var fields = params[param];
                        			if(!fields || fields == &#x27;&#x27;){
                        				queryfields.push({field:param, remotefield:param});
                        			}else{
                        				queryfields.push({field:param, remotefield:fields});
                        			}
                        		}
                        	}
                        	
                        	var queryparams = {};
                        	if(queryfields &amp;&amp; request.query)
                        		for(var querfield in queryfields){
                        			var field = queryfields[querfield];
                        			
                        			if(request.query[field.field] &amp;&amp; request.query[field.field] != &#x27;&#x27;){
                        				queryparams[field.remotefield] = request.query[field.field];
                        			}
                        		}
                        	if(query){
                        		for(var q in query)
                        			queryparams[q] = query[q];
                        		
                        	}
                        	return queryparams;
                        }
                        
                        /**
                         * To get the server options for sending to the remote server request
                         * 
                         * @method serach_remoteoptions
                         * 
                         * @param {} query uery parameters to include
                         * @param {} request http request
                         * 
                         * @return server_options fromatted server options
                         * @private
                         */
                        RemoteService.prototype.serach_remoteoptions = function(query, request){
                        	var instance = this;
                        
                        	var path = instance.serveroptions.search.path;
                        	if(instance.serveroptions.search &amp;&amp; instance.serveroptions.search.sub_path)
                        		path = path + &#x27;/&#x27; + instance.serveroptions.search.sub_path;
                        	
                        	var querystring;
                        	var queryparams = instance.searchqueryparams_(query, request);
                        	
                        	if(queryparams)
                        		querystring = queryparams.join(&#x27;&amp;&#x27;);
                        	if(querystring &amp;&amp; path.indexOf(&#x27;?&#x27;) == -1)
                        		path = path + &#x27;?&#x27; + querystring;
                        	
                        	else if(querystring)
                        		path = path + &#x27;&amp;&#x27; + querystring;
                        	
                        	var server_options = {
                              host: instance.serveroptions.host,
                              port: instance.serveroptions.port,
                              path: path,
                              oauth:instance.serveroptions.oauth,
                              secure:instance.serveroptions.secure||false
                            };
                        	
                        	return server_options;
                        }
                        
                        /**
                         * To search for records 
                         * 
                         * @method search
                         * 
                         * @param {} query search query
                         * @param {} request http request
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} cache Whether to cache the record in to the local database or not
                         * @return 
                         */
                        RemoteService.prototype.search = function(query, request, callback, cache){
                        	var instance = this;
                        	
                        	var server_options = instance.serach_remoteoptions(query, request);
                        	
                        	util.getJSON(server_options, request, function(err, results){
                        		if(err){
                        			logger.getInstance().warn(&#x27;Simpleportal -ervice wrapper&#x27;, &#x27;Some Error while retreiving data from remote server!!&#x27; + err);
                        			callback(err);
                        		}else{
                        			callback(err, results);
                        		}
                        	});
                        }
                        
                        /**
                         * To ge the details of a record from the remote server
                         * @method details
                         * 
                         * @param {} id id of the object
                         * @param {} request http request
                         * @param {callback} callback The callback to excecute when complete
                         * @param {} cache Whether to cache the record in to the local database or not
                         * @return 
                         */
                        RemoteService.prototype.details = function(id, request, callback, cache){
                        	var instance = this;
                        	
                        	var path = instance.service.configuration.search.path;
                        	if(instance.service.configuration.details &amp;&amp; instance.service.configuration.search.details)
                        		path = instance.service.configuration.details.path + &#x27;/&#x27; + id;
                        	
                        	if(id){
                                path = path + &#x27;/&#x27; + id;
                                
                                if(id.indexOf(&#x27;/&#x27;) == -1 &amp;&amp; instance.serveroptions.details &amp;&amp; instance.serveroptions.details.sub_path)
                                    path = path + &#x27;/&#x27; + instance.serveroptions.details.sub_path;
                            }else if(instance.serveroptions.details &amp;&amp; instance.serveroptions.details.sub_path)
                                path = path + &#x27;/&#x27; + instance.serveroptions.details.sub_path;
                        	
                        	var server_options = {
                              host: instance.service.configuration.host,
                              port: instance.service.configuration.port,
                              path: path,
                              oauth:instance.serveroptions.oauth,
                              secure:instance.serveroptions.secure||false
                            };
                        	logger.getInstance().info(&#x27;Simpleportal -service wrapper&#x27;, &#x27;Getting details from remote server.&#x27;);
                        	logger.getInstance().info(&#x27;Simpleportal -service wrapper&#x27;, server_options);
                        	
                        	util.getJSON(server_options, request, function(err, results){
                        		if(err){
                        			logger.getInstance().warn(&#x27;Simpleportal -service wrapper&#x27;, &#x27;Some Error while retreiving data from remote server!!&#x27; + err);
                        			callback(err);
                        		}else{
                        			callback(err, results);
                        		}
                        	});
                        }
                        
                        /**
                         * To remove a record from the remote server
                         * 
                         * @method remove
                         * @param {} id id of the record
                         * @param {} request http request
                         * 
                         * @param {callback} callback The callback to excecute when complete
                         */
                        RemoteService.prototype.remove = function(id, request, callback){
                        	var instance = this;
                        	
                        	var path = instance.service.configuration.search.path;
                        	if(instance.service.configuration.details &amp;&amp; instance.service.configuration.details.path)
                        		path = instance.service.configuration.details.path;
                        	
                        	if(id){
                                path = path + &#x27;/&#x27; + id;
                                
                                if(instance.service.configuration.details &amp;&amp; instance.service.configuration.details.path){}
                                else if(id.indexOf(&#x27;/&#x27;) == -1 &amp;&amp; instance.serveroptions.details &amp;&amp; instance.serveroptions.details.sub_path)
                                    path = path + &#x27;/&#x27; + instance.serveroptions.details.sub_path;
                            }else if(instance.serveroptions.details &amp;&amp; instance.serveroptions.details.sub_path)
                                path = path + &#x27;/&#x27; + instance.serveroptions.details.sub_path;
                        	
                        	var server_options = {
                              host: instance.service.configuration.host,
                              port: instance.service.configuration.port,
                              path: path,
                              oauth:instance.serveroptions.oauth,
                              secure:instance.serveroptions.secure||false,
                              method: &#x27;DELETE&#x27;
                            };
                        	
                        	logger.getInstance().info(&#x27;Simpleportal -service wrapper&#x27;, &#x27;Getting details from remote server.&#x27;);
                        	logger.getInstance().info(&#x27;Simpleportal -service wrapper&#x27;, server_options);
                        	
                        	util.post(server_options, request, function(err, results){
                        		if(err){
                        			logger.getInstance().warn(&#x27;Simpleportal -service wrapper&#x27;, &#x27;Some Error while retreiving data from remote server!!&#x27; + err);
                        			callback(err);
                        		}else{
                        			callback(err, results);
                        		}
                        	});
                        };
                        
                        exports.CRUDService = Service;
                        exports.StorageService = StorageService;
                        exports.RemoteService = RemoteService;
                        exports.RService = RService;
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
